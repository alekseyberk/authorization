# Обёртка над Keycloak

Проект объединяет Angular‑фронтенд и Go‑бэкенд, создавая понятный интерфейс для Keycloak на русском языке. Решение закрывает базовые сценарии (регистрация, авторизация) и добавляет инструменты администрирования: роли, группы, отслеживание событий, контроль активных сессий.

## Состав

| Сервис | Порт | Описание |
| --- | --- | --- |
| `frontend` | `4200` | Angular 20, standalone‑компоненты, русскоязычный UI с onboarding’ом, профилем и панелью администратора. |
| `backend` | `8081` | Go + gocloak. Выступает прокси к Keycloak Admin API, предоставляет REST для обёртки. |
| `keycloak` | `8080` | Keycloak (Docker), конфигурируется автоматически при старте backend. |

## Быстрый старт

```bash
docker-compose up --build
# Frontend: http://localhost:4200
# Backend API: http://localhost:8081
# Keycloak: http://localhost:8080
```

> Первого администратора создаём POST‑запросом на `http://localhost:8081/api/bootstrap-admin` (передаём логин/пароль/email). Он получает роль `app-admin`.

## Backend REST

| Метод | Путь | Назначение |
| --- | --- | --- |
| `GET /api/public` | Тестовый публичный ответ. |
| `GET /api/protected` | Тестовый защищённый ответ (требует токен). |
| `GET /api/user` | Возвращает информацию о текущем пользователе по токену. |
| `POST /api/bootstrap-admin` | Разовая инициализация первого `app-admin`. |
| `GET /api/admin/overview` | Метрики, свежие регистрации/логины, активные сессии. |
| `GET /api/admin/roles` | Список ролей и групп с привязанными ролями. |
| `POST /api/admin/roles` | Создание новой realm‑роли. |
| `POST /api/admin/groups` | Создание группы и опциональное назначение ролей. |
| `POST /api/admin/groups/{id}/roles` | Назначение ролей существующей группе. |
| `GET /api/admin/users/roles` | Последние пользователи + их роли и группы. |

Все `/api/admin/*` требуют realm‑роль `app-admin` (проверяется через Keycloak Admin API).

## Интерфейс

- **Шапка**: статус Keycloak, кнопки «Войти/Создать аккаунт», бейджи ролей, авто‑появление ссылки «Администрирование» для админов.
- **Главная**: чек‑лист пользователя, визуальное объяснение шагов, подсказки по ролям/группам.
- **Профиль**: данные из Keycloak и кнопка «Запросить профиль с backend» (показывает, что Go‑сервис принимает токен).
- **Тест API**: две кнопки, демонстрирующие публичный и защищённый запросы.
- **Администрирование**:
  - метрики (пользователи, админы, группы, роли);
  - ленты «кто зарегистрировался» и «кто вошёл и под какой ролью»;
  - список активных сессий (кто онлайн прямо сейчас);
  - формы для создания ролей/групп и назначения ролей группам;
  - таблица «пользователь → роли → группы».

Весь текст и подсказки — на русском языке, ключевые действия пояснены в UI.

## Точки расширения

- В `frontend/src/app/services/admin-api.service.ts` можно добавить новые вызовы REST без изменения компонентов.
- В `backend/main.go` все административные хендлеры сгруппированы в одном файле; при необходимости добавляйте собственные эндпоинты и подключайте их в `setupRoutes`.
- На главной странице оставлены подсказки, чтобы быстро адаптировать интерфейс под конкретный бизнес‑процесс.
